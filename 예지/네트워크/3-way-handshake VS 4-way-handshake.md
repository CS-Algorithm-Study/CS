# 🔸 3-way-handshake

- TCP가 데이터를 전송하기 전에 네트워크 연결을 설정하는 과정

![3](https://github.com/DAHLIACHOI/Algorithm/assets/48826098/7f393038-4e94-48fa-9582-f221f978e1c5)

1. 클라이언트가 서버에 접속을 요청하는 SYN 패킷을 보낸다.
2. 서버가 존재한다면 클라이언트의 요청인 SYN을 받고 클라이언트에게 요청을 수락한다는 의미인 ACK와 SYN이 설정된 패킷을 보낸다.
3. 클라리언트가 서버의 수락 응답인 ACK와 SYN을 받고 ACK를 다시 서버에게 보내면 연결이 되었다는 의미이다.


   

**👉 서버가 존재하든 안하든 무조건 정보를 보내는 IP 프로토콜과는 다르게 서버가 있는지 확인을 하기 때문에 더욱 효율성 있는 방법이다.**



💡 하지만 여기서 연결됐다는 뜻은 물리적을 연결되었다는 뜻이 아니라 그냥 논리적으로 연결된 것!



# 🔸 4-way-handshake

- TCP 연결을 해제하는 과정
    
    ![4핸드](https://github.com/DAHLIACHOI/Algorithm/assets/48826098/1cf5dc02-47b7-470d-b85e-93a93756baf8)


1. 클라이언트가 서버에게 연결을 종료하겠다는 FIN 플래그를 전송한다.
    1. 서버는 FIN 플래그로 응답하기 전까지 연결을 계속 유지한다.
2. 서버는 클라이언트에게 확인의 의미인 ACK 플래그가 설정된 패킷을 보내고 자신의 통신이 끝날 때까지 기다린다. → TIME_WAIT 상태
    1. 이때, 자신이 전송할  패킷이 남아있다면 이어서 전송한다.
3. 서버의 통신이 끝났으면 연결 종료 요청에 합의한다는 의미로 클라이언트에게 FIN 플래그가 설정된 패킷을 보낸다.
4. 클라이언트는 확인 응답인 ACK 플래그가 설정된 패킷을 보낸다.
5. 연결 종료

## ✍️ 요약

> TCP는 3-way-handshake를 통해 연결을 설정하고 4-way-handshake를 통해 해제하기 때문에 정확하고 안정적으로 데이터를 전달할 수 있다.
> 

## ⚙️ 참고

### 🔸 TCP 플래그

| FLAG | 의미 |
| --- | --- |
| SYN | - TCP에서 세션을 성립할 때 가장 먼저 보내는 패킷<br>- 임의적으로 시퀀스 번호를 설정해서 세션을 연결하는데 사용되고 초기에 시퀀스 번호를 보냄 |
| ACK | - 상대방으로부터 패킷을 받았다는 것을 알려주는 패킷<br>- 다른 플래그와 같이 출력되는 경우도 있음<br>- 받은 사람이 보낸 사람 시퀀스 번호에 TCP계층에서 길이 또는 데이터 양을 더한 것과 같은 ACK를 보냄 (일반적으로 +1 해서 보냄)<br>- 이 응답을 통해 패킷에 대한 성공, 실패를 판단 |
| FIN | - 세션 연결을 종료시킬 때 사용됨<br>- 더이상 전송할 데이터가 없음 |
| RST | - 재설정하는 과정이고 양방향에서 동시에 일어남<br>- 비 정상적인 세션 연결 끊기에 해당<br>- 이 패킷을 보내는 곳이 현재 접속하고 있는 곳과 즉시 연결을 끊고자 할 때 사용 |
| PSH | - 텔넷과 같은 상호작용이 중요한 프로토콜의 경우 빠른 응답이 중요한다. 이때 받은 데이터를 즉시 목적지인 OSI 7계층의 응용계층으로 전송하도록 하는 플래그임<br>- 대화형 트래픽에 사용되는 것으로 버퍼가 채워지기를 기다리지 않고 데이터를 전달<br>- 데이터는 버퍼링 없이 바로 위 계층이 아닌 7계층의 응용계층으로 전달 |
| URG | - Urgent pointer 유효한지 나타냄<br>→ Urgent pointer는 전송하는 데이터 중에서 긴급히 전달해야 할 내용이 있을 경우에 사용<br>- 긴급한 데이터는 다른 데이터에 비해 우선순위가 높아야 됨 |
